<!DOCTYPE html>
<html>
  <head>
    <title>API Documentation</title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body { font-family: Arial, sans-serif; margin: 0; }
      header {
        background: #2c3e50; color: white; padding: 1rem;
        display: flex; justify-content: space-between; align-items: center; gap: 1rem;
        flex-wrap: wrap;
      }
      .controls { display: flex; align-items: center; gap: 0.75rem; }
      select, button, label[for="file-input"] {
        padding: 0.45rem 0.6rem; font-size: 1rem; border-radius: 6px; border: 0;
      }
      label[for="file-input"] {
        background: #ecf0f1; color: #2c3e50; cursor: pointer;
      }
      #dropzone {
        border: 2px dashed #bbb; border-radius: 8px; margin: 1rem;
        padding: 0.75rem; text-align: center; font-size: 0.95rem; color: #555;
      }
      #dropzone.dragover { border-color: #2c3e50; color: #2c3e50; }
      #redoc-container { min-height: calc(100vh - 140px); }
      .hint { font-size: 0.85rem; color: #888; margin: 0 1rem 1rem; }
    </style>
  </head>
  <body>
    <header>
      <h2 style="margin:0;">API Documentation</h2>
      <div class="controls">
        <label for="version">Version:</label>
        <select id="version">
          <option value="./v1/greetings-v1.yaml">v1</option>
          <option value="./v2/greetings-v2.yaml">v2</option>
          <option value="./v3/greetings-v3.yaml">v3</option>
        </select>

        <label for="file-input">Upload YAML/JSON</label>
        <input id="file-input" type="file" accept=".yaml,.yml,.json" style="display:none">
      </div>
    </header>

    <div id="dropzone">Drop your OpenAPI YAML/JSON here (or use the Upload button)</div>
    <p class="hint">Tip: Uploaded files render locally in your browser and are not sent anywhere.</p>

    <div id="redoc-container"></div>

    <!-- ReDoc -->
    <script src="https://cdn.redoc.ly/redoc/latest/bundles/redoc.standalone.js"></script>
    <!-- YAML parser -->
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js" integrity="sha256-1wlY6tJ9s2pDk3k5o5cR2m+V4JcE5u3pWQm5wT8R3X8=" crossorigin="anonymous"></script>

    <script>
      const redocEl = document.getElementById('redoc-container');
      const versionSel = document.getElementById('version');
      const fileInput = document.getElementById('file-input');
      const dropzone = document.getElementById('dropzone');

      function renderFromUrl(url) {
        Redoc.init(url, {}, redocEl);
      }

      function renderFromObject(specObj) {
        // ReDoc accepts a JS object as the first arg
        Redoc.init(specObj, {}, redocEl);
      }

      function isLikelyJson(text) {
        const t = text.trim();
        return (t.startsWith('{') || t.startsWith('['));
      }

      async function handleText(text) {
        try {
          const spec = isLikelyJson(text) ? JSON.parse(text) : jsyaml.load(text);
          renderFromObject(spec);
        } catch (err) {
          alert('Failed to parse file. Ensure it is valid OpenAPI YAML/JSON.\\n\\n' + err);
          console.error(err);
        }
      }

      function handleFile(file) {
        const reader = new FileReader();
        reader.onload = e => handleText(e.target.result);
        reader.readAsText(file);
      }

      // Version dropdown -> load from URL
      versionSel.addEventListener('change', () => renderFromUrl(versionSel.value));

      // Upload button
      fileInput.addEventListener('change', e => {
        const file = e.target.files && e.target.files[0];
        if (file) handleFile(file);
        fileInput.value = ''; // reset so same file can be re-selected
      });

      // Drag & drop
      ;['dragenter','dragover'].forEach(evt =>
        dropzone.addEventListener(evt, e => { e.preventDefault(); e.dataTransfer.dropEffect = 'copy'; dropzone.classList.add('dragover'); })
      );
      ;['dragleave','drop'].forEach(evt =>
        dropzone.addEventListener(evt, e => { e.preventDefault(); dropzone.classList.remove('dragover'); })
      );
      dropzone.addEventListener('drop', e => {
        const file = e.dataTransfer.files && e.dataTransfer.files[0];
        if (file) handleFile(file);
      });

      // Initial load: default to v1 in your current setup
      window.onload = () => renderFromUrl(versionSel.value);
    </script>
  </body>
</html>
